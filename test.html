<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #showScroll {
      height: 200px;
      width: 300px;
      border: 1px solid;
      overflow-y: overlay;
    }

    #scrollTop {
      border-style: solid;
      border-color: transparent transparent red transparent;
      border-width: 20px;
      width: 0;
      height: 0;
      position: fixed;
      top: 10px;
      left: 10px;
    }

    /* img {
      width: 300px;
      height: 500px;
    } */

    #example {
      width: 300px;
      height: 200px;
      border: 25px solid #E8C48F;
      padding: 20px;
      overflow: auto;
    }

    #images_garlly {
      position: relative;
    }
  </style>
</head>

<body id="body1">
  <!-- <div id="scrollTop"></div>
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>

  <img data-src="./image-20230129221928214.png" src="./image-20220624070109347.png" />
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>
  <img data-src="./image-20230129221928214.png" src="./image-20220624070109347.png" />
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>
  <img data-src="./image-20230129221928214.png" src="./image-20220624070109347.png" />
  <div id="showScroll">
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
    <div>123</div>
  </div>
  <img data-src="./image-20230129221928214.png" src="./image-20220624070109347.png" /> -->

  <!-- 文档的宽度包含了滚动条 -->
  <!-- <div id="main" style="position: relative">
    <div id="example" style="position: absolute ; left: 180px; top: 180px">
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
      <div>Text</div>
    </div>
  </div> -->

  <div id="images_garlly"></div>
  <script>
    this.container = document.getElementById('images_garlly');
    let imgUrls = [
      {
        src: 'https://gw.alipayobjects.com/zos/antfincdn/LlvErxo8H9/photo-1503185912284-5271ff81b9a8.webp',
        description: '',
        name: '去上海东方明珠塔',
        id: '1223'
      },
      {
        src: 'https://gw.alipayobjects.com/zos/antfincdn/cV16ZqzMjW/photo-1473091540282-9b846e7965e3.webp',
        description: '',
        name: '去三亚玩',
        id: '1233'
      },
      {
        src: 'https://gw.alipayobjects.com/zos/antfincdn/x43I27A55%26/photo-1438109491414-7198515b166b.webp',
        description: '',
        name: '去澳门旅游',
        id: '1243'
      }
      ,
      {
        src: 'https://ns-strategy.cdn.bcebos.com/ns-strategy/upload/fc_big_pic/part-00551-3454.jpg',
        description: '',
        name: '去澳门旅游2',
        id: '12432'
      },
      {
        src: 'https://img1.baidu.com/it/u=1250510633,1329722166&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=1083',
        description: '',
        name: '去澳门旅游3',
        id: '12433'
      }
      // ,
      // {
      //   src: 'https://img1.baidu.com/it/u=2817635320,853214720&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800',
      //   description: '',
      //   name: '去澳门旅游4',
      //   id: '12434'
      // },
      // {
      //   src: 'https://img1.baidu.com/it/u=2817635320,853214720&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800',
      //   description: '',
      //   name: '去澳门旅游5',
      //   id: '12435'
      // },
      // {
      //   src: 'https://img1.baidu.com/it/u=2817635320,853214720&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800',
      //   description: '',
      //   name: '去澳门旅游6',
      //   id: '12436'
      // },
      // {
      //   src: 'https://img1.baidu.com/it/u=3886879761,923648310&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500',
      //   description: '',
      //   name: '去澳门旅游7',
      //   id: '12437'
      // }
    ]

    let imgMargin = 10, columnLength = 4, conatiner = 800, flag = 0;
    for (let i = 0; i < imgUrls.length; i++) {
      const item = imgUrls[i];
      checkImage(item.src).then(item2 => {
        flag++;
        item['new_width'] = Math.floor((800 - imgMargin * (columnLength + 2)) / 4);
        item['new_height'] = Math.floor((item2.height * item['new_width']) / item2.width);
      }).catch(() => {
        flag++;
      }).finally(() => {
        if (flag === imgUrls.length) {
          console.log('flag', flag, imgUrls.length);
          let saveColumnHeight = [];  // 定义一个数组，用于存储 每一列所有元素的高度 之和

          for (let j = 0; j < imgUrls.length; j++) {
            const item3 = imgUrls[j];


            item3['new_top'] = Math.floor(j < 4 ? 0 : (imgUrls[j - 4]['new_top'] + imgUrls[j - 4]['new_height'] + 10));
            item3['new_left'] = Math.floor((j % 4 === 0) ? 0 : (imgUrls[j - 1]['new_left'] + imgUrls[j - 1]['new_width'] + 10));


            item3['heightT'] = item3['new_top'] + item3['new_height']
            // 每次创建第二行的时候，找到高度最小的那一行，放置下一个元素；

            // 当大于4之后，每次创建的时候找到之前5个数高度最低的，将新增的这个放进去，新增的这个left  是找到的那个的left, top是找到的那个的 高 + top
            let imgDom = document.createElement('img');

            if (j > 3) {
              let prePosition = {
                left: 0,
                top: 0
              }
              let items = document.querySelectorAll('.item');
              let minHeight = imgUrls[0]['new_top'] + imgUrls[0]['new_height'], ind = 0;
              let aaa = imgUrls.slice(j - 4, j)
              console.log("aaa", j, aaa);
              minHeight = imgUrls.slice(j - 4, j).sort((a, b) => {
                let aValue = a['new_top'] + a['new_height']
                let bValue = b['new_top'] + b['new_height']
                return aValue - bValue
              })[0]

              prePosition = { 
                top: minHeight.new_top + minHeight.new_height + 10,
                left: minHeight.new_left,
                inde: 3
              }

              imgDom.style.left = prePosition.left + 'px';
              imgUrls[j]['preTop'] = prePosition.left
              imgUrls[j]['preLeft'] = prePosition.top
              imgDom.style.top = prePosition.top + 'px';

              // saveColumnHeight[3] = (imgUrls[3]['new_top'] + imgUrls[3]['new_height']) + (imgUrls[j]['new_top'] + imgUrls[j]['new_height'])
              // console.log('saveColumnHeight', saveColumnHeight, j % 4);
            } else {
              imgUrls[j]['preTop'] = 0;
              imgUrls[j]['preLeft'] = item3['new_left'];
              imgDom.style.left = item3['new_left'] + 'px';
              imgDom.style.top = item3['new_top'] + 'px';
              saveColumnHeight[j] = item3['new_height'] + 10;// 当布局的元素还没占满一行时，继续向数组中添加第一行第i列的高度

            }



            imgDom.style.width = item3['new_width'] + 'px';
            imgDom.style.height = item3['new_height'] + 'px';
            
            imgDom.className = 'item'
            imgDom.style.position = 'absolute'
            imgDom.setAttribute('src', item3.src);
            imgDom.setAttribute('alt', item3.name)

            this.container.appendChild(imgDom);
          }
          console.log(imgUrls);

        }
      })
    }


    function checkImage(url) {
      return new Promise((resolve, reject) => {
        let img = new Image()
        img.src = url
        img.onload = () => {
          resolve(img)
        }
        img.onerror = () => {
          reject()
        }
      })
    }
// --------------------------------------
    // window.addEventListener('scroll', function (event) {
    // let divDom = document.createElement('div')
    // divDom.innerHTML = new Date()
    // document.body.appendChild(divDom)

    // });

    // window.onscroll = showVisible;
    // function isVisible(elem) {

    //   let coords = elem.getBoundingClientRect();

    //   let windowHeight = document.documentElement.clientHeight;

    //   // 顶部元素边缘可见吗？
    //   let topVisible = coords.top > 0 && coords.top < windowHeight;

    //   // 底部元素边缘可见吗？
    //   let bottomVisible = coords.bottom < windowHeight && coords.bottom > 0;

    //   return topVisible || bottomVisible;
    // }
    // function showVisible(params) {
    //   for (let img of document.querySelectorAll('img')) {
    //     let realSrc = img.dataset.src;
    //     if (!realSrc) continue;
    //     setTimeout(() => {
    //       if (isVisible(img)) {
    //         img.src = realSrc;
    //         img.dataset.src = '';
    //       }
    //     }, 1000)

    //   }
    // }
    // scrollTop.addEventListener('click', function () {
    //   window.scrollTo(0, 0)
    // })



  </script>
</body>

</html>